<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>短信平台</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="baidu-site-verification" content="zNwez22Bcq"/>
    <meta name="google-site-verification" content="6hC_46bMT6_bGxmL_Ec5V_7xnPSnQBhQBl8y3MtfoFc" />
    <meta name="Baiduspider" content="noarchive"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
    <link rel="shortcut icon" th:href="${oem.tab_logo_url}"/>
    <link rel='stylesheet' href='css/reset.css' th:href="@{/css/reset.css?v=1.0}"/>
    <link rel='stylesheet' href='css/base.css' th:href="@{/css/base.css?v=1.1}"/>
    <link rel='stylesheet' href='css/oem.css' th:href="@{/css/oem.css?v=1.0}"/>
    <link rel='stylesheet' href='/font/iconfont.css' th:href="@{/font/iconfont.css?v=1.0}"/>
    <link rel='stylesheet' href='/css/main.css' th:href="@{/css/main.css?v=1.0}"/>
    <script src="/js/jquery.min.js"  th:src="@{/js/jquery.min.js}"></script>
    <script type="text/javascript" src="/js/common.js" th:src="@{/js/common.js}"></script>
    <script type="text/javascript" th:src="@{/js/layer/layer.js}"></script>

</head>
<style>
    .test-title{
        width: 100%;
        height: 60px;
        line-height:60px;
        padding-left: 30px;
        font-size: 20px;
        border-bottom: 1px solid #CCCCCC;
        background-color: #ffffff;
    }
    .text-area{
        margin-left: 60px;
        margin-top: 20px;
        font-size: 15px;
    }
    .startTest{
        margin-left:146px;
    }
    .ml50{
        margin-left: 50px;
    }
    .pt40{
        padding-top: 40px;
    }
    .js-errorResult{
        padding:20px;

    }
    .js-errorResult  div{
        word-break: break-all;
    }
    .tip{
        margin-bottom:20px;
        line-height: 40px;
        border:1px solid #2fb26a;
        padding:0 10px;
        background-color: #f3fff8;
        margin-top:20px;
        color:#2fb26a;
    }
</style>
<body>
<div id="wrap" class="clearfix">
    <!-- 左侧导航栏 bf-->
    <div id="sidebar" th:replace="console :: #sidebar">
        <div class="logo">
            <a href="/" title="云之讯"><img src="/img/logo2.png" alt="云之讯" /></a>
        </div>
        <div class="nav">
            <ul>
                <li><a href="/console"  class="cur"><span class="iconfont icon-shouyeshouye"></span>首页</a></li>
                <li>
                    <a href="javascript:void(0)"><span class="iconfont icon-duanxin"></span>传统短信<i></i></a>
                    <ul class="sub-nav">
                        <li><a href="/console/bussiness/send.html" class="">短信发送<span></span></a></li>
                        <li><a href="/console/bussiness/template.html" class="">短信模板管理<span></span></a></li>
                        <li><a href="/console/bussiness/record.html"  class="">短信发送记录<span></span></a></li>
                        <li><a href="/console/bussiness/daystat.html" class="">短信数据统计<span></span></a></li>
                        <li><a href="/console/bussiness/price.html"  class="">国际短信报价<span></span></a></li>
                    </ul>
                </li>
                <li>
                    <a href="javascript:void(0)"><span class="iconfont icon-caixin2"></span>彩印<i></i></a>
                    <ul class="sub-nav">
                        <li><a href="/console/mms/send.html" class="">彩印发送<span></span></a></li>
                        <li><a href="/console/mms/template.html" class="">彩印模版管理<span></span></a></li>
                        <li><a href="/console/mms/record.html"  class="">彩印发送记录<span></span></a></li>
                        <li><a href="/console/mms/ussdday.html" class="">彩印数据统计<span></span></a></li>
                    </ul>
                </li>
                <li>
                    <a href="javascript:void(0)"><span class="iconfont icon-qianbi01"></span>财务管理<i></i></a>
                    <ul class="sub-nav">
                        <li><a href="/console/order/list.html" class="">我的订单<span></span></a></li>
                    </ul>
                </li>
                <li>
                    <a href="javascript:void(0)" class=""><span class="iconfont icon-shenfenzheng"></span>账户管理<i></i></a>
                    <ul class="sub-nav">
                        <li><a href="/console/account/info.html" class="">账户资料<span></span></a></li>
                        <li><a href="/console/account/security.html" class="">账户安全<span></span></a></li>
                    </ul>
                </li>
                <li>
                    <a href="javascript:void(0)"><span class="iconfont icon-bangzhuzhongxin"></span>帮助中心<i></i></a>
                    <ul class="sub-nav">
                        <li><a href="/console/help/smsAccessIntroduce.html" class="">短信接入<span></span></a></li>
                        <li><a href="/console/help/FAQ.html">FAQ<span></span></a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <!-- 左侧导航栏 ef -->

    <!-- 右边内容 bf -->
    <div id="main">
        <div class="top idx-top clearfix">
            <h1>内容测试</h1>
            <div class="top-r ft-r" th:fragment="user">
                <span class="right_border_line">ID: <span th:text="${accountModel.clientId}">b00000</span></span>
                <a href="${ctx}/quit" th:href="@{/quit}"><span class="glyphicon glyphicon-off"></span> 退出</a>
            </div>
            <input type="hidden" th:value="${accountModel.clientId}" id="clientId">
        </div>
        <div class="text-area">
            <div class="tip">检测到敏感内容属于绝对拦截！</div>
            <span style="line-height: 40px;"><span style="color: red;">*</span>短信内容：</span>
            <textarea name="content" id="content" cols="100" rows="10" style="vertical-align: top;background-color: #ffffff" placeholder="输入需要测试的短信内容"></textarea>
        </div>
        <div style="margin-top:20px;">
            <button class="btn btn-md btn-green startTest">开始测试</button>
            <button class="btn btn-md btn-green-block clearTpl">清空模板</button>
        </div>

    </div>
    <!-- 右边内容 ef -->
</div>
<div class="js-result" style="display: none">
    <div class="pt40 ml50">
        <span>本次测试结果为</span><span class="permission" style="color: green;font-size: 20px">无敏感内容</span></span>
    </div>
</div>
<div class="js-errorResult">
    <div id="smsContentDisplay"></div>
</div>
<script type="text/javascript">
    var url = '/content/user';
    $(".clearTpl").click(function(){
        $("#content").val("");
    })
        $(".startTest").click(function () {
        var cont = $("#content").val();
        if(!cont){
            layer.msg("短信内容不能为空",{icon:2})
            return
        }
        if(cont.length > 500){
            layer.msg("短信内容不能超过500个字",{icon:2})
            return
        }
        $.ajax({
            url:url,
            type:"POST",
            data: {content:cont},
            content:'cont',
            dataType:'json',
            success:function(data){
                var keywords = [];
                var res = JSON.parse(data);
                if(res['200']){
                    $(".permission").show();
                    layer.open({
                        type: 1,
                        title: '测试结果', //不显示标题
                        area: ['500px','190px'],
                        content: $('.js-result')
                    });
                    return false;
                }
                for(var k in res){
                    if(k >= 500){
                        var obj = {};
                        var arr = res[k].split(",");
                        obj.begin = arr[0];
                        obj.end = arr[1];
                        keywords.push(obj);
                    }
                }
                console.log(keywords);
                if(keywords.length > 0){
                    var htmlArray = [];
                    var smscont = $("#content").val();
                    var p1 = 0, p2 = 0;
                    for(var i=0; i<keywords.length; i++){
                        var begin = keywords[i].begin;
                        var end = keywords[i].end;
                        p2 = keywords[i].begin;
                        htmlArray.push(smscont.substring(p1, p2));
                        htmlArray.push("<span style='color:#ff0000'>" + smscont.substring(begin, p1=end) + "</span>");
                    }
                    htmlArray.push(smscont.substring(p1));
                    console.log(htmlArray)
                    $("#smsContentDisplay")[0].innerHTML  = htmlArray.join("");// 将关键字标红然后替换在短信内容的页面容器中
                    layer.open({
                        type: 1,
                        title: '测试结果', //不显示标题
                        area: ['500px','320px'],
                        content: $('.js-errorResult')
                    });
                }
            }
        });
    })

</script>
</body>
</html>